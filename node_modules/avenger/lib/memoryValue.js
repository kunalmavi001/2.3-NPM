"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.memoryValue = void 0;
var Query_1 = require("./Query");
var TE = require("fp-ts/lib/TaskEither");
var IORef_1 = require("fp-ts/lib/IORef");
var Strategy_1 = require("./Strategy");
var command_1 = require("./command");
var IO = require("fp-ts/lib/IO");
var E = require("fp-ts/lib/Either");
function memoryValue(initialValue) {
    var ref = new IORef_1.IORef(initialValue);
    var fetch = function () { return TE.fromIOEither(IO.io.map(ref.read, E.right)); };
    var query = Query_1.queryStrict(fetch, Strategy_1.refetch);
    var command = command_1.command(function (value) {
        return TE.fromIOEither(IO.io.map(ref.write(value), E.right));
    }, {
        query: query
    });
    return {
        query: query,
        command: command,
        get: ref.read,
        set: ref.write
    };
}
exports.memoryValue = memoryValue;
