"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.contramap = exports.command = void 0;
var invalidate_1 = require("./invalidate");
var TE = require("fp-ts/lib/TaskEither");
var O = require("fp-ts/lib/Option");
var pipeable_1 = require("fp-ts/lib/pipeable");
function command(cmd, queries) {
    return function (a, ia) {
        return TE.taskEither.chain(cmd(a), function (p) {
            return pipeable_1.pipe(queries, O.fromNullable, O.fold(function () { return TE.taskEither.of(p); }, function (queries) { return TE.taskEither.map(invalidate_1.invalidate(queries, ia), function () { return p; }); }));
        });
    };
}
exports.command = command;
function contramap(fa, f) {
    return function (a) { return fa(f(a)); };
}
exports.contramap = contramap;
